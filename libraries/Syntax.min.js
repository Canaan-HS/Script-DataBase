// ==UserScript==
// @name         Syntax
// @version      2025.09.16
// @author       Canaan HS
// @description  Library for simplifying code logic and syntax
// @namespace    https://greasyfork.org/users/989635
// @match        *://*/*
// @license      MPL-2.0
// ==/UserScript==
const Lib=(()=>{function y(a=document,b,c){if(1!==a?.nodeType&&9!==a?.nodeType)return c?[]:void 0;const d=b[0],e=b.slice(1);if(/[ .#:[\]>+~*,()^$=]/.test(e))return c?a.querySelectorAll(b):a.querySelector(b);if(!c&&"#"===d)return 9===a.nodeType?a.getElementById(e):a.querySelector(b);if("."===b[0])return a=a.getElementsByClassName(e),c?[...a]:a[0];a=a.getElementsByTagName(b);return c?[...a]:a[0]}function P(...a){if(0!==a.length){var b={},c=a,d={dev:!0,group:null,collapsed:!0};if(1<a.length){const f=
a[0],n=a.at(-1),p=f?.constructor===Object,u=n?.constructor===Object;if(u&&!p)b=n,c=a.slice(0,-1);else if(p&&!u)b=f,c=a.slice(1);else if(p&&u){const r=new Set(Object.keys(d));b=Object.keys(f).filter(w=>r.has(w)).length;Object.keys(n).filter(w=>r.has(w)).length>b?(b=n,c=a.slice(0,-1)):(b=f,c=a.slice(1))}}var {dev:e,group:h,collapsed:k}={...d,...b};if(!e||0===c.length)return new Proxy({},{get(){}});var m=f=>{"count"===f?H.count(c[0]):(f=H[f]||H.log,h?(k?console.groupCollapsed(h):console.group(h),f(...c),
console.groupEnd()):f(...c))},g=setTimeout(()=>m("log",c));return new Proxy({},{get(f,n){clearTimeout(g);m(n,c)}})}}async function Q(a,b,c=crypto.randomUUID(),d=!0){if(d||!I.has(c)){var e=document.getElementById(c);e||(e=document.createElement(a),e.id=c,(a=R.head)?a.appendChild(e):S("head").then(h=>{h.appendChild(e)}));e.textContent+=b;I.add(c)}}async function S(a,b=null,c={}){const d=Array.isArray(a)?T.queryMap:T.queryElement,{raf:e=!1,all:h=!1,timeout:k=8,throttle:m=0,debounce:g=50,visibility:f=
!0,subtree:n=!0,childList:p=!0,attributes:u=!0,characterData:r=!1,timeoutResult:w=!1,root:z=document}=c||{};return new Promise((l,t)=>{const q=async function(){let x,v;if(e){let A;const F=()=>{(v=d(a,h))?(cancelAnimationFrame(A),clearTimeout(x),b?.(v),l(v)):A=requestAnimationFrame(F)};A=requestAnimationFrame(F);x=setTimeout(()=>{cancelAnimationFrame(A);w&&(b?.(v),l(v))},1E3*k)}else{const [A,F]=0<m?[J,m]:[K,g],L=new MutationObserver(A(()=>{if(v=d(a,h))L.disconnect(),clearTimeout(x),b?.(v),l(v)},F));
L.observe(z,{subtree:n,childList:p,attributes:u,characterData:r});x=setTimeout(()=>{L.disconnect();w&&(b?.(v),l(v))},1E3*k)}};f&&"hidden"===document.visibilityState?document.addEventListener("visibilitychange",()=>q(),{once:!0}):q()})}function U(a,b,c,d){let e;return null!=c?V[B(c)](b,a,c):(e=b.getItem(a),void 0!=e?V[B(JSON.parse(e))](b,e):d)}function J(a,b){let c=0;return(...d)=>{const e=Date.now();e-c>=b&&(c=e,a(...d))}}function K(a,b){let c=null;return(...d)=>{clearTimeout(c);c=setTimeout(function(){a(...d)},
b)}}function W(a){a=new Blob([a],{type:"application/javascript"});const b=URL.createObjectURL(a),c=new Worker(b),d=c.terminate;c.terminate=function(){d.call(c);URL.revokeObjectURL(b)};return c}const Z=new DOMParser,B=a=>Object.prototype.toString.call(a).slice(8,-1);[Document.prototype,Element.prototype].forEach(a=>{a.$q=function(b){return y(this,b,!1)};a.$qa=function(b){return y(this,b,!0)}});const M={$text(a=null){return null===a?this?.textContent?.trim():this.textContent=a?.trim()??""},$copy(a=
!0){return this.cloneNode(a)},$iHtml(a=null){return null===a?this.innerHTML:this.innerHTML=a},$oHtml(a=null){return null===a?this.outerHTML:this.outerHTML=a},$iAdjacent(a,b="beforeend"){null!=a&&(1===a.nodeType?this.insertAdjacentElement(b,a):this.insertAdjacentHTML(b,a))},$sAttr(a,b){this.setAttribute(a,b)},$dAttr(a){this.removeAttribute(a)},$gAttr(a){return this.getAttribute(a)},$hAttr(a){return this.hasAttribute(a)},$addClass(...a){this.classList.add(...a)},$delClass(...a){this.classList.remove(...a)},
$toggleClass(a,b){this.classList.toggle(a,b)},$replaceClass(a,b){this.classList.replace(a,b)},$hasClass(a){return this.classList.contains(a)}};Object.assign(Node.prototype,M);const X=Object.keys(M)[0];Object.defineProperty(Object.prototype,X,{value:function(a=null){return M[X].call(this,a)},writable:!0,configurable:!0});const R={$q:document.$q.bind(document),$Q:(a,b)=>y(a,b,!1),$qa:document.$qa.bind(document),$Qa:(a,b)=>y(a,b,!0),html:document.documentElement,get head(){const a=document.head;a&&Object.defineProperty(this,
"head",{value:a,writable:!1});return a},get body(){const a=document.body;a&&Object.defineProperty(this,"body",{value:a,writable:!1});return a},img:document.images,link:document.links,script:document.scripts,style:document.styleSheets,$url:location.href,get url(){return location.href},$origin:location.origin,get origin(){return location.origin},$domain:location.hostname,get domain(){return location.hostname},$lang:navigator.language,get lang(){return navigator.language},$agen:navigator.userAgent,get agen(){return navigator.userAgent},
createDomFragment:a=>document.createRange().createContextualFragment(a),get createFragment(){return document.createDocumentFragment()},title:(a=null)=>null===a?document.title:document.title=a,cookie:(a=null)=>null===a?document.cookie:document.cookie=a,createUrl:a=>URL.createObjectURL(a),_on:(a,{type:b,listener:c,add:d})=>"string"===typeof b&&"function"===typeof c?(a.addEventListener(b,c,d),{[b]:()=>a.removeEventListener(b,c,d)}):{},createElement(a,b,c){const [d,e,h={}]="string"===typeof a?[null,a,
b]:[a,b,c];if(e){var {id:k,title:m,class:g,text:f="",rows:n,cols:p,on:u={},style:r={},attr:w={},...z}=h,l=Object.assign(document.createElement(e),{textContent:f});k&&(l.id=k);m&&(l.title=m);g&&(l.className=g);void 0!==n&&(l.rowSpan=n);void 0!==p&&(l.colSpan=p);Object.assign(l,z);Object.assign(l.style,"string"===typeof r?{cssText:r}:r);Object.entries(w).forEach(([q,x])=>l.setAttribute(q,x));var t={};Array.isArray(u)?u.forEach(q=>Object.assign(t,this._on(l,q))):"object"===typeof u&&Object.assign(t,
this._on(l,u));Object.assign(l,{on(q,x,v){this.addEventListener(q,x,v);Object.assign(t,{[q]:()=>this.removeEventListener(q,x,v)})},off(q){t[q]?.();delete t[q]},offAll(){Object.keys(t).forEach(q=>{t[q]();delete t[q]})}});return 1===d?.nodeType?d.appendChild(l):l}}},D=new Map,H={log:(...a)=>console.log(...a),warn:(...a)=>console.warn(...a),table:(...a)=>console.table(...a),trace:(...a)=>console.trace(...a),debug:(...a)=>console.debug(...a),error:(...a)=>console.error(...a),count:a=>console.count(a)},
I=new Set,G=new Map,T={queryMap:(a,b)=>{a=a.map(c=>y(document,c,b));return b?a.every(c=>0<c.length)&&a:a.every(Boolean)&&a},queryElement:(a,b)=>{a=y(document,a,b);return(b?0<a.length:a)&&a}},V={String:(a,b,c)=>null!=c?(a.setItem(b,JSON.stringify(c)),!0):JSON.parse(b),Number:(a,b,c)=>null!=c?(a.setItem(b,JSON.stringify(c)),!0):Number(b),Array:(a,b,c)=>null!=c?(a.setItem(b,JSON.stringify(c)),!0):(b=JSON.parse(b),Array.isArray(b[0])?new Map(b):b),Object:(a,b,c)=>null!=c?(a.setItem(b,JSON.stringify(c)),
!0):JSON.parse(b),Boolean:(a,b,c)=>null!=c?(a.setItem(b,JSON.stringify(c)),!0):JSON.parse(b),Date:(a,b,c)=>null!=c?(a.setItem(b,JSON.stringify(c)),!0):new Date(b),Map:(a,b,c)=>(a.setItem(b,JSON.stringify([...c])),!0)},Y={Process:(a,b,c=null)=>{a=a[b.toLowerCase()];return"Function"===B(a)?a(c):a?a:"None"}},N={ko:"Korea","ko-KR":"Korea",ja:"Japan","ja-JP":"Japan",ru:"Russia","ru-RU":"Russia",en:"English","en-US":"English","en-GB":"English","en-AU":"English","en-CA":"English","en-NZ":"English","en-IE":"English",
"en-ZA":"English","en-IN":"English",zh:"Simplified","zh-CN":"Simplified","zh-SG":"Simplified","zh-MY":"Simplified","zh-TW":"Traditional","zh-HK":"Traditional","zh-MO":"Traditional"},C=new Set,O=a=>void 0===a||null===a?null:a,E=new Map;return function(...a){const b={};for(const c of a)c&&Object.defineProperties(b,Object.getOwnPropertyDescriptors(c));return b}({get sX(){return window.scrollX},get sY(){return window.scrollY},get iW(){return window.innerWidth},get iH(){return window.innerHeight},get platform(){let a;
a=void 0!==navigator.userAgentData?.mobile?navigator.userAgentData.mobile?"Mobile":"Desktop":window.matchMedia?.("(max-width: 767px), (pointer: coarse)")?.matches?"Mobile":/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"Mobile":"Desktop";Object.defineProperty(this,"platform",{value:a,writable:!1});return a}},R,{addStyle:(a,b,c)=>Q("style",a,b,c),addScript:(a,b,c)=>Q("script",a,b,c),session:(a,{value:b=null,error:c}={})=>U(a,sessionStorage,b,c),local:(a,
{value:b=null,error:c}={})=>U(a,localStorage,b,c),delV:a=>GM_deleteValue(a),allV:()=>O(GM_listValues()),setV:(a,b)=>GM_setValue(a,b),getV:(a,b)=>O(GM_getValue(a,b)),setJV:(a,b,c=0)=>GM_setValue(a,JSON.stringify(b,null,c)),getJV(a,b){try{return JSON.parse(O(GM_getValue(a,b)))}catch{return b}},eventRecord:D,addRecord:I,observerRecord:G,$type:B,onE:async function(a,b,c,d={},e=null){try{"string"===typeof a&&(a=y(document,a));let h=b.split(/\s*[,|/]\s*/).filter(Boolean);if(0===h.length)throw Error("No event types provided");
if(1===h.length)a.addEventListener(b,c,d);else{let k=null;const m=g=>{clearTimeout(k);k=setTimeout(()=>c(g),15)};h.forEach(g=>a.addEventListener(g,m,d))}e?.(!0)}catch{e?.(!1)}},onEvent:async function(a,b,c,d={}){const {mark:e,...h}=d;"string"===typeof a&&(a=y(document,a));d=e??a;const k=D.get(d);k?.has(b)||(a.addEventListener(b,c,h),k||D.set(d,new Map),D.get(d).set(b,c))},offEvent:async function(a,b,c){"string"===typeof a&&(a=y(document,a));c=c??a;const d=D.get(c)?.get(b);d&&(a.removeEventListener(b,
d),D.get(c).delete(b))},onUrlChange:function(a,b=15){function c(n){clearTimeout(e);k||"urlchange"!==n||(k=!0);e=setTimeout(()=>{k&&d(!1,!0);a({type:n,url:location.href,domain:location.hostname})},Math.max(15,b))}function d(n=!0,p=!1){p&&h||(clearTimeout(e),history.pushState=m,history.replaceState=g,n&&window.removeEventListener("urlchange",f.urlchange),window.removeEventListener("popstate",f.popstate),window.removeEventListener("hashchange",f.hashchange),h=!0)}let e=null,h=!1,k=!1;const m=history.pushState,
g=history.replaceState,f={urlchange:()=>c("urlchange"),popstate:()=>c("popstate"),hashchange:()=>c("hashchange")};window.addEventListener("urlchange",f.urlchange);window.addEventListener("popstate",f.popstate);window.addEventListener("hashchange",f.hashchange);history.pushState=function(){m.apply(this,arguments);c("pushState")};history.replaceState=function(){g.apply(this,arguments);c("replacestate")};return{off:d}},log:P,createLog:function(a={}){return(...b)=>P(...b,a)},$observer:async function(a,
b,c={},d=null){const {mark:e="",debounce:h=0,throttle:k=100,subtree:m=!0,childList:g=!0,attributes:f=!0,characterData:n=!1}=c||{};if(e&&(c=G.get(e))){if(c.target===a)return;c.ob.disconnect();G.delete(e)}const [p,u]=0<h?[K,h]:[J,k];c={subtree:m,childList:g,attributes:f,characterData:n};const r=new MutationObserver(p(()=>{b()},u));r.observe(a,c);e&&G.set(e,{target:a,ob:r});d?.({ob:r,op:c})},waitEl:S,$throttle:J,$debounce:K,scopeParse:function(a,b){if("string"!==typeof a||""===a.trim())return b;const c=
b.length;let d=!1;const e=new Set,h=new Set,k=(g,f,n)=>{const p=g<=f;for(;p?g<=f:g>=f;p?g++:g--)n.add(g)};let m;for(m of a.split(/\s*[\.,|/]\s*/))if(/^(!|-)?\d+(~\d+|-\d+)?$/.test(m)){a=m.slice(1);const g=/^[!-]/.test(m),f=/[~-]/.test(a),[n,p]=g?[h,a]:(d=!0,[e,m]),[u,r]=f?p.split(/-|~/):[p,p];u===r?n.add(+u-1):k(+u-1,+r-1,n)}return(d?[...e]:[...b.keys()]).filter(g=>!h.has(g)&&g<c&&0<=g).sort((g,f)=>g-f).map(g=>b[g])},createWorker:W,formatTemplate:function(a,b){if("Object"!==B(a))return"Template must be an object";
a=Object.fromEntries(Object.entries(a).map(([c,d])=>[c.toLowerCase(),d]));return"String"===B(b)?b.replace(/\{\s*([^}\s]+)\s*\}/g,(c,d)=>Y.Process(a,d)):"Object"===B(b)?Object.entries(b).map(([c,d])=>Y.Process(a,c,d)):{"Unsupported format":b}},createCompressor:function(){let a=W('importScripts("https://cdn.jsdelivr.net/npm/fflate@0.8.2/umd/index.min.js");onmessage = function(e) {const { filesWithOptions } = e.data;const fileNames = Object.keys(filesWithOptions);let totalSize = 0;let processedSize = 0;fileNames.forEach(name => {totalSize += filesWithOptions[name].data.length;});const chunks = [];const zip = new fflate.Zip((err, data, final) => {if (err) {postMessage({ type: "error", error: err.message });return;}chunks.push(data);if (final) {let size = 0;let offset = 0;chunks.forEach(c => size += c.length);const zipped = new Uint8Array(size);chunks.forEach(c => {zipped.set(c, offset);offset += c.length;});postMessage({ type: "done", data: zipped }, [zipped.buffer]);}});(async () => {for (const name of fileNames) {const { data, level } = filesWithOptions[name];const fileStream = new fflate.ZipPassThrough(name, { level });zip.add(fileStream);fileStream.push(data, true);processedSize += data.length;postMessage({ type: "progress", loaded: processedSize, total: totalSize });} zip.end();})().catch(err => {postMessage({ type: "error", error: err.message });});}');
const b=new Set("mp4 mov avi mkv flv wmv webm mpg mpeg m4v ogv 3gp asf ts vob rm rmvb m2ts f4v mts zip rar 7z gz bz2 .pg jpeg png gif webp bmp tiff tif svg .eic heif raw ico psd mp3 aac flac wav ogg pdf".split(" "));let c={},d=[];return{async destroyWorker(){a&&(a.terminate(),a=null)},async file(e,h){const k=new Promise(async m=>{const g=await h.arrayBuffer();c[e]=new Uint8Array(g);m()});d.push(k);return k},async generateZip(e={},h){await Promise.all(d);return new Promise((k,m)=>{if(0===Object.keys(c).length)return m("Empty Data Error");
const g={};Object.entries(c).forEach(([f,n])=>{var p=f.split(".").pop().toLowerCase();p=b.has(p)?0:e.level||5;g[f]={data:n,level:p}});a.postMessage({filesWithOptions:g},Object.values(g).map(f=>f.data.buffer));a.onmessage=f=>{f=f.data;"progress"===f.type?h?.(f.loaded/f.total*100):"done"===f.type?(h?.(100),c={},d=[],k(new Blob([f.data],{type:"application/zip"}))):"error"===f.type&&(c={},d=[],m(f.error))}})}}},createNnetworkObserver:function(a={}){function b(){var l=Date.now();if(l-w<f)return z;w=l;
if(navigator.connection){const {effectiveType:t,saveData:q}=navigator.connection;z="4g"!==t||q?"3g"===t||"4g"===t&&q?"normal":"poor":"good"}else 5<=r.length&&(l=r.reduce((t,q)=>t+q,0)/r.length,z=l<h?"good":l>k?"poor":"normal");return z}let {MAX_Delay:c=2E3,MIN_CONCURRENCY:d=1,MAX_CONCURRENCY:e=16,Good_Network_THRESHOLD:h=500,Poor_Network_THRESHOLD:k=1500,adaptiveFactors:m={good:{delayFactor:.8,threadFactor:1.2},normal:{delayFactor:1,threadFactor:1},poor:{delayFactor:1.5,threadFactor:.7}},TIME_THRESHOLD:g=
1E3,Network_Check_Interval:f=1E4,EMA_ALPHA:n=.3,ADJUSTMENT_FACTOR:p=.25,History_Size:u=10}=a||{},{responseHistory:r=[],lastNetworkCheck:w=0,networkCondition:z="normal"}={};return function(l,t,q=null,x=0){l=Date.now()-l;r.push(l);r.length>u&&r.shift();g=!g||1>=r.length?l:n*l+(1-n)*g;g=Math.max(20,Math.min(2E3,g));const {delayFactor:v,threadFactor:A}=m[b()];l/=g;t=Math.max(x,Math.min(t*(1+(l-1)*p*v),c));return null!==q?[Math.round(t),Math.round(Math.max(d,Math.min(q*(1-(l-1)*p*A),e)))]:Math.round(t)}},
outputTXT:async function(a,b,c=null){try{b="string"===typeof b?b.endsWith(".txt")?b:`${b}.txt`:`Untitled-${crypto.randomUUID().slice(9,23)}.txt`;const d=new Blob([a],{type:"text/plain"}),e=document.createElement("a");e.href=URL.createObjectURL(d);e.download=b;e.click();URL.revokeObjectURL(e.href);e.remove();c?.({State:!0})}catch(d){c?.({State:!1,Info:d})}},outputJson:async function(a,b,c=null){try{a="string"===typeof a?a:JSON.stringify(a,null,4);b="string"===typeof b?b.endsWith(".json")?b:`${b}.json`:
`Untitled-${crypto.randomUUID().slice(9,23)}.json`;const d=new Blob([a],{type:"application/json"}),e=document.createElement("a");e.href=URL.createObjectURL(d);e.download=b;e.click();URL.revokeObjectURL(e.href);e.remove();c?.({State:!0})}catch(d){c?.({State:!1,Info:d})}},runTime:function(a=null,{lable:b="Elapsed Time:",log:c=!0,format:d=!0,style:e="\u001b[1m\u001b[36m%s\u001b[0m"}={}){if(!a)return performance.now();a=d?`${((performance.now()-a)/1E3).toPrecision(3)}s`:performance.now()-a;return c?console.log(e,
`${b} ${a}`):a},getDate:function(a=null){const b=new Date,c={year:b.getFullYear(),month:`${b.getMonth()+1}`.padStart(2,"0"),date:`${b.getDate()}`.padStart(2,"0"),hour:`${b.getHours()}`.padStart(2,"0"),minute:`${b.getMinutes()}`.padStart(2,"0"),second:`${b.getSeconds()}`.padStart(2,"0")};return(d=>d.replace(/{([^}]+)}/g,(e,h)=>c[h]??"Error"))("string"===typeof a?a:"{year}-{month}-{date} {hour}:{minute}:{second}")},translMatcher:function(a,b=navigator.language,c="en-US"){return a[N[b]]??a[N[c]]??a[N["en-US"]]},
regMenu:function(a,b={}){let {name:c="regMenu",index:d=1,reset:e=!1}=b||{};e&&([...C].map(h=>GM_unregisterMenuCommand(h)),C.clear());for(let [h,k]of Object.entries(a))a=`${c}-${d++}`,"function"===typeof k&&(k={func:k}),GM_registerMenuCommand(h,()=>{k.func()},{id:a,title:k.desc,autoClose:k.close,accessKey:k.hotkey}),C.add(a)},unMenu:async function(a){null==a?([...C].map(b=>GM_unregisterMenuCommand(b)),C.clear()):Array.isArray(a)?a.forEach(b=>{C.delete(b)&&GM_unregisterMenuCommand(b)}):C.delete(a)&&
GM_unregisterMenuCommand(a)},storeListen:function(a,b){a.forEach(c=>{if(!E.has(c)){const d=GM_addValueChangeListener(c,function(e,h,k,m){b({key:e,ov:h,nv:k,far:m})});E.set(c,d)}});return{off(c){const d=E.get(c);d&&(GM_removeValueChangeListener(d),E.delete(c))},offAll(){for(const c of E.values())GM_removeValueChangeListener(c);E.clear()}}},sleep:a=>new Promise(b=>setTimeout(b,a)),domParse:a=>Z.parseFromString(a,"text/html"),nameFilter:a=>a.replace(/[\/\?<>\\:\*\|":]/g,"").trim(),getFill:a=>Math.max(2,
`${a}`.length),suffixName(a,b="webp"){try{if(!a)return b;const c=new URL(a,location.href);a=/\.([^.]+)$/;return(c.pathname.match(a)?.[1]||c.search.match(a)?.[1])?.toLowerCase().trim()||b}catch{return b}},mantissa(a,b,c="0",d=null){return d?`${++a}`.padStart(b,c)+`.${this.suffixName(d)}`:`${++a}`.padStart(b,c)}})})();