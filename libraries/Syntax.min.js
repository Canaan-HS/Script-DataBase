// ==UserScript==
// @name         Syntax
// @version      2025.10.13
// @author       Canaan HS
// @description  Library for simplifying code logic and syntax
// @namespace    https://greasyfork.org/users/989635
// @match        *://*/*
// @license      MPL-2.0
// ==/UserScript==
const Lib=(()=>{function y(a=document,b,c){if(1!==a?.nodeType&&9!==a?.nodeType)return c?[]:void 0;const e=b[0],d=b.slice(1);if(/[ .#:[\]>+~*,()^$=]/.test(d))return c?a.querySelectorAll(b):a.querySelector(b);if(!c&&"#"===e)return 9===a.nodeType?a.getElementById(d):a.querySelector(b);if("."===b[0])return a=a.getElementsByClassName(d),c?[...a]:a[0];a=a.getElementsByTagName(b);return c?[...a]:a[0]}async function W(a,b,c=crypto.randomUUID(),e=!0){if(e||!K.has(c)){var d=document.getElementById(c);d||(d=
document.createElement(a),d.id=c,(a=H.head)?a.appendChild(d):X("head").then(k=>{k.appendChild(d)}));d.textContent+=b;K.add(c)}}async function X(a,b,c={}){const e=Array.isArray(a)?Y.queryMap:Y.queryElement,{raf:d=!1,all:k=!1,timeout:l=8,throttle:g=0,debounce:n=50,visibility:f=!0,subtree:m=!0,childList:h=!0,attributes:t=!0,characterData:p=!1,timeoutResult:r=!1,root:v=document}=c||{};return new Promise((q,u)=>{const w=async function(){let z,x;if(d){let C;const I=()=>{(x=e(a,k))?(cancelAnimationFrame(C),
clearTimeout(z),b?.(x),q(x)):C=requestAnimationFrame(I)};C=requestAnimationFrame(I);z=setTimeout(()=>{cancelAnimationFrame(C);r&&(b?.(x),q(x))},1E3*l)}else{const [C,I]=0<g?[L,g]:[M,n],N=new MutationObserver(C(()=>{if(x=e(a,k))N.disconnect(),clearTimeout(z),b?.(x),q(x)},I));N.observe(v,{subtree:m,childList:h,attributes:t,characterData:p});z=setTimeout(()=>{N.disconnect();r&&(b?.(x),q(x))},1E3*l)}};f&&"hidden"===document.visibilityState?document.addEventListener("visibilitychange",()=>w(),{once:!0}):
w()})}function Z(a){if(!a||!a.trim())return 0;if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(a)){var b=(new Date(a)).getTime();if(!isNaN(b))return Math.floor(b/1E3)}b=new Date;var c=[...a.matchAll(/(\d+)\s*([YyMDdhms])/g)];if(0===c.length)return 0;var e=a=0,d=0,k=0,l=0,g=0;for(const n of c){c=parseInt(n[1],10);const f=n[2];switch(f.toLowerCase()){case "y":a+=c;break;case "d":d+=c;break;case "h":k+=c;break;case "s":g+=c;break;default:"M"===f?e+=c:"m"===f&&(l+=c)}}b.setFullYear(b.getFullYear()+a);
b.setMonth(b.getMonth()+e);b.setDate(b.getDate()+d);b.setHours(b.getHours()+k);b.setMinutes(b.getMinutes()+l);b.setSeconds(b.getSeconds()+g);return Math.floor(b.getTime()/1E3)}function O(a,b,c,{space:e=0,expireStr:d}={}){const k=A(c);c={type:k,data:aa[k]?.(c)??c};(d=Z(d))&&(c.expire=d);a(b,JSON.stringify(c,null,e))}function P(a,b,c,{autoRemove:e=!1,removeer:d}={}){a=a(b);if(null==a)return c;try{a=JSON.parse(a);const k=a instanceof Object;if(k&&a.expire&&Date.now()>1E3*a.expire)return d(b),c;let l,
g;k?(l=a.type??"Object",g=a.data??a):(l=A(a),g=a);const n=ba[l]?.(g)??g;e&&d(b);return n}catch{return"object"===typeof a&&H.isEmpty(a)||"string"===typeof a&&a.startsWith("[object")?c:a}}function L(a,b){let c=0;return(...e)=>{const d=Date.now();d-c>=b&&(c=d,a(...e))}}function M(a,b){let c;return(...e)=>{clearTimeout(c);c=setTimeout(function(){a(...e)},b)}}function Q(a){a=new Blob([a],{type:"application/javascript"});const b=URL.createObjectURL(a),c=new Worker(b),e=c.terminate;c.terminate=function(){e.call(c);
URL.revokeObjectURL(b)};return c}function R(a,b="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"){function c(f){return new Promise((m,h)=>{const t=new Blob([f],{type:"application/octet-stream"}),p=new FileReader;p.onload=function(r){r=r.target.result;r=r.substring(r.indexOf(",")+1);m(r)};p.onerror=function(r){h(r)};p.readAsDataURL(t)})}function e(f,m,h){return new Promise(t=>{const p=g++;n.set(p,t);d.postMessage({type:f,data:m,level:h,requestId:p},[m.buffer])})}let d=Q(`${a||`importScripts('${b}')`}onmessage = function(e) {const { type, data, level, requestId } = e.data;const bytes = type === "compress" ? pako.deflate(data, { level }) : pako.inflate(data);postMessage({ data: bytes, requestId }, [bytes.buffer]);}`);
const k=new TextEncoder,l=new TextDecoder;let g=0;const n=new Map;d.onmessage=f=>{const {requestId:m,data:h}=f.data;n.has(m)&&(n.get(m)(h),n.delete(m))};return{async destroyWorker(){d&&(d.terminate(),d=null)},async compress(f,{level:m=5,base64:h=!0,stringify:t=!0}={}){if(null==f)return f;f=await e("compress",k.encode(t?JSON.stringify(f):f),m);return h?await c(f):f},async decompress(f,m=!0){if(null==f)return f;if(!(f instanceof Uint8Array)){f=atob(f);const h=f.length,t=new Uint8Array(h);
for(let p=0;p<h;p++)t[p]=f.charCodeAt(p);f=t}f=await e("decompress",f);f=l.decode(f);return m?JSON.parse(f):f}}}const ha=new DOMParser,A=a=>Object.prototype.toString.call(a).slice(8,-1);[Document.prototype,Element.prototype].forEach(a=>{a.$q=function(b){return y(this,b,!1)};a.$qa=function(b){return y(this,b,!0)}});let B=null;const S=()=>window.trustedTypes?.getPolicy?.("default")??window.trustedTypes?.createPolicy?.(Symbol("myPolicy").toString(),{createHTML:a=>a}),T={$text(a){return null==a?this?.textContent?.trim():
this.textContent=a?.trim()??""},$copy(a=!0){return this.cloneNode(a)},$iHtml(a){return null==a?this.innerHTML:this.innerHTML=a},$safeiHtml(a){if(null==a)return this.innerHTML;try{B??=S(),B?this.appendChild(document.createRange().createContextualFragment(B.createHTML(a))):this.innerHTML=a}catch(b){console.error(b)}},$oHtml(a){return null==a?this.outerHTML:this.outerHTML=a},$iAdjacent(a,b="beforeend"){null!=a&&(1===a.nodeType?this.insertAdjacentElement(b,a):this.insertAdjacentHTML(b,a))},$safeiAdjacent(a,
b="beforeend"){if(null!=a){if(1===a.nodeType)return this.insertAdjacentElement(b,a);try{B??=S(),B?this.insertAdjacentHTML(b,B.createHTML(a)):this.insertAdjacentHTML(b,a)}catch(c){console.error(c)}}},$safeiBefore(a,b="beforeend"){if(null!=a)try{B??=S();if(!B)throw Error("Policy not found");const c=document.createRange().createContextualFragment(B.createHTML(a));switch(b){case "beforebegin":this.parentNode?.insertBefore(c,this);break;case "afterbegin":this.insertBefore(c,this.firstChild);break;case "beforeend":this.appendChild(c);
break;case "afterend":this.parentNode?.insertBefore(c,this.nextSibling)}}catch(c){console.error(c)}},$sAttr(a,b){this.setAttribute(a,b)},$dAttr(a){this.removeAttribute(a)},$gAttr(a){return this.getAttribute(a)},$hAttr(a){return this.hasAttribute(a)},$addClass(...a){this.classList.add(...a)},$delClass(...a){this.classList.remove(...a)},$toggleClass(a,b){this.classList.toggle(a,b)},$replaceClass(a,b){this.classList.replace(a,b)},$hasClass(a){return this.classList.contains(a)}};Object.assign(Node.prototype,
T);const ca=Object.keys(T)[0];Object.defineProperty(Object.prototype,ca,{value:function(a=null){return T[ca].call(this,a)},writable:!0,configurable:!0});const H={$q:document.$q.bind(document),$Q:(a,b)=>y(a,b,!1),$qa:document.$qa.bind(document),$Qa:(a,b)=>y(a,b,!0),html:document.documentElement,get head(){const a=document.head;a&&Object.defineProperty(this,"head",{value:a,writable:!1});return a},get body(){const a=document.body;a&&Object.defineProperty(this,"body",{value:a,writable:!1});return a},
img:document.images,link:document.links,script:document.scripts,style:document.styleSheets,$url:location.href,get url(){return location.href},$origin:location.origin,get origin(){return location.origin},$domain:location.hostname,get domain(){return location.hostname},$lang:navigator.language,get lang(){return navigator.language},$agen:navigator.userAgent,get agen(){return navigator.userAgent},isEmpty(a){for(const b in a)return!1;return!0},createDomFragment:a=>document.createRange().createContextualFragment(a),
get createFragment(){return document.createDocumentFragment()},title:a=>null==a?document.title:document.title=a,cookie:a=>null==a?document.cookie:document.cookie=a,createUrl:a=>URL.createObjectURL(a),_on:(a,b)=>{const c={};for(const e of Object.keys(b)){let d=b[e];d&&("function"===typeof d&&(d={listen:d}),d.listen&&(a.addEventListener(e,d.listen,d.add),c[e]=()=>a.removeEventListener(e,d.listen,d.add)))}return c},createElement(a,b,c,e){const [d,k,l={},g="beforeend"]="string"===typeof a?[void 0,a,b,
c]:[a,b,c,e];if(k){var {class:n,text:f="",rows:m,cols:h,on:t={},style:p={},attr:r={},...v}=l;a=document.createElement(k);a.textContent=f;n&&(a.className=n);void 0!==m&&(a.rowSpan=m);void 0!==h&&(a.colSpan=h);Object.assign(a,v);"string"===typeof p?a.style.cssText=p:Object.assign(a.style,p);for(const u in r)a.setAttribute(u,r[u]);var q="object"!==typeof t||this.isEmpty(t)?{}:this._on(a,t);Object.assign(a,{on(u,w,z){this.addEventListener(u,w,z);Object.assign(q,{[u]:()=>this.removeEventListener(u,w,z)})},
off(u){q[u]?.();delete q[u]},offAll(){Object.keys(q).forEach(u=>{q[u]();delete q[u]})}});return 1===d?.nodeType?d.insertAdjacentElement(g,a):a}}},E=new Map,U={log:(...a)=>console.log(...a),warn:(...a)=>console.warn(...a),table:(...a)=>console.table(...a),trace:(...a)=>console.trace(...a),debug:(...a)=>console.debug(...a),error:(...a)=>console.error(...a),count:a=>console.count(a)},K=new Set,J=new Map,Y={queryMap:(a,b)=>{a=a.map(c=>y(document,c,b));return b?a.every(c=>0<c.length)&&a:a.every(Boolean)&&
a},queryElement:(a,b)=>{a=y(document,a,b);return(b?0<a.length:a)&&a}},ba={Set:a=>new Set(a),Map:a=>new Map(a),Date:a=>new Date(a)},aa={Set:a=>a instanceof Set?[...a]:a,Map:a=>a instanceof Map?[...a]:a,Date:a=>a instanceof Date?a.toISOString():a},da=localStorage.removeItem.bind(localStorage),ia=localStorage.setItem.bind(localStorage),ja=localStorage.getItem.bind(localStorage),ea=sessionStorage.removeItem.bind(sessionStorage),ka=sessionStorage.setItem.bind(sessionStorage),la=sessionStorage.getItem.bind(sessionStorage);
let F;const fa={process:(a,b,c)=>{a=a[b.toLowerCase()];return"Function"===A(a)?a(c):a?a:"None"}},V={ko:"Korea","ko-KR":"Korea",ja:"Japan","ja-JP":"Japan",ru:"Russia","ru-RU":"Russia",en:"English","en-US":"English","en-GB":"English","en-AU":"English","en-CA":"English","en-NZ":"English","en-IE":"English","en-ZA":"English","en-IN":"English",zh:"Simplified","zh-CN":"Simplified","zh-SG":"Simplified","zh-MY":"Simplified","zh-TW":"Traditional","zh-HK":"Traditional","zh-MO":"Traditional"},D=new Set,G=new Map;
return function(...a){const b={};for(const c of a)c&&Object.defineProperties(b,Object.getOwnPropertyDescriptors(c));return b}({get sX(){return window.scrollX},get sY(){return window.scrollY},get iW(){return window.innerWidth},get iH(){return window.innerHeight},get platform(){let a;a=void 0!==navigator.userAgentData?.mobile?navigator.userAgentData.mobile?"Mobile":"Desktop":window.matchMedia?.("(max-width: 767px), (pointer: coarse)")?.matches?"Mobile":/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?
"Mobile":"Desktop";Object.defineProperty(this,"platform",{value:a,writable:!1});return a}},H,{addStyle:(a,b,c)=>W("style",a,b,c),addScript:(a,b,c)=>W("script",a,b,c),delLocal:a=>da(a),setLocal:(a,b,c)=>O(ia,a,b,{expireStr:c}),getLocal:(a,b,c)=>P(ja,a,b,{autoRemove:c,removeer:da}),delSession:a=>ea(a),setSession:(a,b,c)=>O(ka,a,b,{expireStr:c}),getSession:(a,b,c)=>P(la,a,b,{autoRemove:c,removeer:ea}),delV:a=>GM_deleteValue(a),allV:()=>GM_listValues()||void 0,setV:(a,b)=>GM_setValue(a,b),getV:(a,b)=>
GM_getValue(a,b)||void 0,setJV:(a,b,{space:c,expireStr:e}={})=>O(GM_setValue,a,b,{space:c,expireStr:e}),getJV:(a,b,c)=>P(GM_getValue,a,b,{autoRemove:c,removeer:GM_deleteValue}),eventRecord:E,addRecord:K,observerRecord:J,$type:A,onE:async function(a,b,c,e={},d){try{"string"===typeof a&&(a=y(document,a));let k=b.split(/\s*[,|/]\s*/).filter(Boolean);if(0===k.length)throw Error("No event types provided");if(1===k.length)a.addEventListener(b,c,e);else{let l;const g=n=>{clearTimeout(l);l=setTimeout(()=>
c(n),15)};k.forEach(n=>a.addEventListener(n,g,e))}d?.(!0)}catch{d?.(!1)}},onEvent:async function(a,b,c,e={}){const {mark:d,...k}=e;"string"===typeof a&&(a=y(document,a));e=d??a;const l=E.get(e);l?.has(b)||(a.addEventListener(b,c,k),l||E.set(e,new Map),E.get(e).set(b,c))},offEvent:async function(a,b,c){"string"===typeof a&&(a=y(document,a));c=c??a;const e=E.get(c)?.get(b);e&&(a.removeEventListener(b,e),E.get(c).delete(b))},onUrlChange:function(a,b=15){function c(m){clearTimeout(d);l||"urlchange"!==
m||(l=!0);d=setTimeout(()=>{l&&e(!1,!0);a({type:m,url:location.href,domain:location.hostname})},Math.max(15,b))}function e(m=!0,h=!1){h&&k||(clearTimeout(d),history.pushState=g,history.replaceState=n,window.removeEventListener("popstate",f.popstate),window.removeEventListener("hashchange",f.hashchange),m&&window.removeEventListener("urlchange",f.urlchange),k=!0)}let d,k=!1,l=!1;const g=history.pushState,n=history.replaceState,f={urlchange:()=>c("urlchange"),popstate:()=>c("popstate"),hashchange:()=>
c("hashchange")};window.addEventListener("urlchange",f.urlchange);window.addEventListener("popstate",f.popstate);window.addEventListener("hashchange",f.hashchange);history.pushState=function(){g.apply(this,arguments);c("pushState")};history.replaceState=function(){n.apply(this,arguments);c("replacestate")};return{off:e}},log:function(...a){if(0!==a.length){var b={},c=a,e={dev:!0,group:null,collapsed:!0};if(1<a.length){const f=a[0],m=a.at(-1),h=f?.constructor===Object,t=m?.constructor===Object;if(t&&
!h)b=m,c=a.slice(0,-1);else if(h&&!t)b=f,c=a.slice(1);else if(h&&t){const p=new Set(Object.keys(e));b=Object.keys(f).filter(r=>p.has(r)).length;Object.keys(m).filter(r=>p.has(r)).length>b?(b=m,c=a.slice(0,-1)):(b=f,c=a.slice(1))}}var {dev:d,group:k,collapsed:l}={...e,...b};if(!d||0===c.length)return new Proxy({},{get(){}});var g=f=>{"count"===f?U.count(c[0]):(f=U[f]||U.log,k?(l?console.groupCollapsed(k):console.group(k),f(...c),console.groupEnd()):f(...c))},n=setTimeout(()=>g("log",c));return new Proxy({},
{get(f,m){clearTimeout(n);g(m,c)}})}},$observer:async function(a,b,c={},e){const {mark:d="",debounce:k=0,throttle:l=100,subtree:g=!0,childList:n=!0,attributes:f=!0,characterData:m=!1}=c||{};if(d&&(c=J.get(d))){if(c.target===a)return;c.ob.disconnect();J.delete(d)}const [h,t]=0<k?[M,k]:[L,l];c={subtree:g,childList:n,attributes:f,characterData:m};const p=new MutationObserver(h(()=>{b()},t));p.observe(a,c);d&&J.set(d,{target:a,ob:p});e?.({ob:p,op:c})},waitEl:X,openDB:async function(a="StorageDB",b=1,
c){return new Promise((e,d)=>{const k=indexedDB.open(a,b),l=a.replace(/db$/i,"").toLowerCase();k.onupgradeneeded=g=>{g=g.target.result;g.objectStoreNames.contains(l)||g.createObjectStore(l)};k.onsuccess=g=>{async function n(m){return new Promise((h,t)=>{const p=f.transaction(l,"readwrite").objectStore(l).delete(m);p.onsuccess=()=>h(p.result);p.onerror=()=>t(p.error)})}const f=g.target.result;e({set:async function(m,h,{compress:t=!0,expireStr:p}={}){const r={};t?(F??=R(c),t=A(h),r.type=t,r.data=await F.compress(aa[t]?.(h)??
h,{base64:!1}),r.compressed=!0):r.data=h;if(h=Z(p))r.expire=h;return new Promise((v,q)=>{const u=f.transaction(l,"readwrite").objectStore(l).put(r,m);u.onsuccess=()=>v(u.result);u.onerror=()=>q(u.error)})},get:async function(m,h,t=!1){const p=f.transaction(l,"readonly").objectStore(l),r=await new Promise((v,q)=>{const u=p.get(m);u.onsuccess=()=>v(u.result);u.onerror=()=>q(h)});if(null==r)return h;try{const v=r instanceof Object;if(v&&r.expire&&Date.now()>1E3*r.expire)return n(m),h;let q;if(v){if(q=
r.data??r,r.compressed){F??=R(c);q=await F.decompress(q);const u=r.type||A(q);q=ba[u]?.(q)??q}}else q=r;t&&n(m);return q}catch{return r}},del:n,destroy:function(){f&&(f.close(),indexedDB.deleteDatabase(a),F.destroyWorker(),setTimeout(()=>F=null,100))}})};k.onerror=()=>d(k.error)})},$throttle:L,$debounce:M,scopeParse:function(a,b){if("string"!==typeof a||""===a.trim())return b;const c=b.length;let e=!1;const d=new Set,k=new Set,l=(g,n,f)=>{const m=g<=n;for(;m?g<=n:g>=n;m?g++:g--)f.add(g)};for(const g of a.split(/\s*[\.,|/]\s*/))if(/^(!|-)?\d+(~\d+|-\d+)?$/.test(g)){a=
g.slice(1);const n=/^[!-]/.test(g),f=/[~-]/.test(a),[m,h]=n?[k,a]:(e=!0,[d,g]),[t,p]=f?h.split(/-|~/):[h,h];t===p?m.add(+t-1):l(+t-1,+p-1,m)}return(e?[...d]:[...b.keys()]).filter(g=>!k.has(g)&&g<c&&0<=g).sort((g,n)=>g-n).map(g=>b[g])},createWorker:Q,formatTemplate:function(a,b){if("Object"!==A(a))return"Template must be an object";a=Object.fromEntries(Object.entries(a).map(([c,e])=>[c.toLowerCase(),e]));return"String"===A(b)?b.replace(/\{\s*([^}\s]+)\s*\}/g,(c,e)=>fa.process(a,e)):"Object"===A(b)?
Object.entries(b).map(([c,e])=>fa.process(a,c,e)):{"Unsupported format":b}},createZip:function(a,b="https://cdn.jsdelivr.net/npm/fflate@0.8.2/umd/index.min.js"){let c=Q(`${a||`importScripts('${b}')`}onmessage = function(e) {const { filesWithOptions } = e.data;const fileNames = Object.keys(filesWithOptions);let totalSize = 0;let processedSize = 0;fileNames.forEach(name => {totalSize += filesWithOptions[name].data.length;});const chunks = [];const zip = new fflate.Zip((err, data, final) => {if (err) {postMessage({ type: "error", error: err.message });return;}chunks.push(data);if (final) {let size = 0;let offset = 0;chunks.forEach(c => size += c.length);const zipped = new Uint8Array(size);chunks.forEach(c => {zipped.set(c, offset);offset += c.length;});postMessage({ type: "done", data: zipped }, [zipped.buffer]);}});(async () => {for (const name of fileNames) {const { data, level } = filesWithOptions[name];const fileStream = new fflate.ZipPassThrough(name, { level });zip.add(fileStream);fileStream.push(data, true);processedSize += data.length;postMessage({ type: "progress", loaded: processedSize, total: totalSize });}zip.end();})().catch(err => {postMessage({ type: "error", error: err.message });});}`);
const e=new Set("mp4 mov avi mkv flv wmv webm mpg mpeg m4v ogv 3gp asf ts vob rm rmvb m2ts f4v mts zip rar 7z gz bz2 .pg jpeg png gif webp bmp tiff tif svg .eic heif raw ico psd mp3 aac flac wav ogg pdf".split(" "));let d={},k=[];return{async destroyWorker(){c&&(c.terminate(),c=null)},async file(l,g){const n=new Promise(async f=>{const m=await g.arrayBuffer();d[l]=new Uint8Array(m);f()});k.push(n);return n},async generateZip(l={},g){await Promise.all(k);return new Promise((n,f)=>{if(H.isEmpty(d))return f("Empty Data Error");
const m={};Object.entries(d).forEach(([h,t])=>{var p=h.split(".").pop().toLowerCase();p=e.has(p)?0:l.level||5;m[h]={data:t,level:p}});c.postMessage({filesWithOptions:m},Object.values(m).map(h=>h.data.buffer));c.onmessage=h=>{h=h.data;"progress"===h.type?g?.(h.loaded/h.total*100):"done"===h.type?(g?.(100),d={},k=[],n(new Blob([h.data],{type:"application/zip"}))):"error"===h.type&&(d={},k=[],f(h.error))}})}}},createStrCompress:R,createNetworkObserver:function(a={}){function b(){var q=Date.now();if(q-
r<f)return v;r=q;if(navigator.connection){const {effectiveType:u,saveData:w}=navigator.connection;v="4g"!==u||w?"3g"===u||"4g"===u&&w?"normal":"poor":"good"}else 5<=p.length&&(q=p.reduce((u,w)=>u+w,0)/p.length,v=q<k?"good":q>l?"poor":"normal");return v}let {MAX_Delay:c=2E3,MIN_CONCURRENCY:e=1,MAX_CONCURRENCY:d=16,Good_Network_THRESHOLD:k=500,Poor_Network_THRESHOLD:l=1500,adaptiveFactors:g={good:{delayFactor:.8,threadFactor:1.2},normal:{delayFactor:1,threadFactor:1},poor:{delayFactor:1.5,threadFactor:.7}},
TIME_THRESHOLD:n=1E3,Network_Check_Interval:f=1E4,EMA_ALPHA:m=.3,ADJUSTMENT_FACTOR:h=.25,History_Size:t=10}=a||{},{responseHistory:p=[],lastNetworkCheck:r=0,networkCondition:v="normal"}={};return function(q,u,w,z=0){q=Date.now()-q;p.push(q);p.length>t&&p.shift();n=!n||1>=p.length?q:m*q+(1-m)*n;n=Math.max(20,Math.min(2E3,n));const {delayFactor:x,threadFactor:C}=g[b()];q/=n;u=Math.max(z,Math.min(u*(1+(q-1)*h*x),c));return null!=w?[Math.round(u),Math.round(Math.max(e,Math.min(w*(1-(q-1)*h*C),d)))]:Math.round(u)}},
outputTXT:async function(a,b,c){try{b="string"===typeof b?b.endsWith(".txt")?b:`${b}.txt`:`Untitled-${crypto.randomUUID().slice(9,23)}.txt`;const e=new Blob([a],{type:"text/plain"}),d=document.createElement("a");d.href=URL.createObjectURL(e);d.download=b;d.click();URL.revokeObjectURL(d.href);d.remove();c?.({State:!0})}catch(e){c?.({State:!1,Info:e})}},outputJson:async function(a,b,c){try{a="string"===typeof a?a:JSON.stringify(a,null,4);b="string"===typeof b?b.endsWith(".json")?b:`${b}.json`:`Untitled-${crypto.randomUUID().slice(9,
23)}.json`;const e=new Blob([a],{type:"application/json"}),d=document.createElement("a");d.href=URL.createObjectURL(e);d.download=b;d.click();URL.revokeObjectURL(d.href);d.remove();c?.({State:!0})}catch(e){c?.({State:!1,Info:e})}},runTime:function(a,{lable:b="Elapsed Time:",log:c=!0,format:e=!0,style:d="\u001b[1m\u001b[36m%s\u001b[0m"}={}){if(!a)return performance.now();a=e?`${((performance.now()-a)/1E3).toPrecision(3)}s`:performance.now()-a;return c?console.log(d,`${b} ${a}`):a},getDate:function(a){const b=
new Date,c={year:b.getFullYear(),month:`${b.getMonth()+1}`.padStart(2,"0"),date:`${b.getDate()}`.padStart(2,"0"),hour:`${b.getHours()}`.padStart(2,"0"),minute:`${b.getMinutes()}`.padStart(2,"0"),second:`${b.getSeconds()}`.padStart(2,"0")};return(e=>e.replace(/{([^}]+)}/g,(d,k)=>c[k]??"Error"))("string"===typeof a?a:"{year}-{month}-{date} {hour}:{minute}:{second}")},translMatcher:function(a,b=navigator.language,c="en-US"){return a[V[b]]??a[V[c]]??a[V["en-US"]]},regMenu:function(a,b={}){let {name:c=
"regMenu",index:e=1,reset:d=!1}=b||{};d&&([...D].map(k=>GM_unregisterMenuCommand(k)),D.clear());for(let [k,l]of Object.entries(a))a=`${c}-${e++}`,"function"===typeof l&&(l={func:l}),GM_registerMenuCommand(k,()=>{l.func()},{id:a,title:l.desc,autoClose:l.close,accessKey:l.hotkey}),D.add(a)},unMenu:async function(a){null==a?([...D].map(b=>GM_unregisterMenuCommand(b)),D.clear()):Array.isArray(a)?a.forEach(b=>{D.delete(b)&&GM_unregisterMenuCommand(b)}):D.delete(a)&&GM_unregisterMenuCommand(a)},storageListen:function(a,
b){a.forEach(c=>{if(!G.has(c)){const e=GM_addValueChangeListener(c,function(d,k,l,g){b({key:d,ov:k,nv:l,far:g})});G.set(c,e)}});return{off(c){const e=G.get(c);e&&(GM_removeValueChangeListener(e),G.delete(c))},offAll(){for(const c of G.values())GM_removeValueChangeListener(c);G.clear()}}},sleep:a=>new Promise(b=>setTimeout(b,a)),domParse:a=>ha.parseFromString(a,"text/html"),nameFilter:a=>a.replace(/[\/\?<>\\:\*\|":]/g,"").trim(),getFill:a=>Math.max(2,`${a}`.length),suffixName(a,b="webp"){try{if(!a)return b;
const c=new URL(a,location.href);a=/\.([^.]+)$/;return(c.pathname.match(a)?.[1]||c.search.match(a)?.[1])?.toLowerCase().trim()||b}catch{return b}},mantissa(a,b,c="0",e){return e?`${++a}`.padStart(b,c)+`.${this.suffixName(e)}`:`${++a}`.padStart(b,c)}})})();